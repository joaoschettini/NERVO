<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clube da Esquina, o álbum perfeito</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body onload="listar()">
    
    <header class="header">
        <a class="logo-header" href="conteudo.html">logo</a>
        <nav class="navbar-header">
            <ul>
                <li><a href="conteudo.html#musica-semana">Música da Semana</a></li>
                <li><a href="conteudo.html#conteudo-materias">Matérias</a></li>
            </ul>
        </nav>
        <ul class="botao">
            <li><a href="perfil.html"><button>Perfil</button></a></li>
        </ul>
    </header>

    <div class="conteudo-materia-esquina">
        <div class="container-conteudo-materia-esquina">
            <div class="texto-materia-esquina">
                <h1>
                    Clube da Esquina, o álbum perfeito
                </h1>
                <p>
                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aperiam veritatis provident hic minus alias ullam sapiente dolorum mollitia, saepe perferendis commodi exercitationem tenetur eum voluptates voluptas odio! Iusto, ipsum fugiat. Lorem, ipsum dolor sit amet consectetur adipisicing elit. Autem ratione dignissimos repudiandae assumenda ullam suscipit repellat laborum numquam. Sint aliquam dignissimos, explicabo et excepturi aliquid ipsam corrupti pariatur ea veniam. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Cupiditate minus perferendis tempora voluptate placeat hic sunt dolor dolores quo molestias consectetur, eaque inventore recusandae at illum necessitatibus nulla earum velit. Lorem ipsum dolor sit amet consectetur adipisicing elit. Nam ipsam saepe corporis dignissimos debitis, quaerat perspiciatis alias veritatis quasi, quis nihil aliquam unde ea deleniti explicabo sit maiores odit iure? Lorem ipsum dolor sit amet consectetur adipisicing elit. Quam, enim neque! Assumenda quam voluptas numquam hic? Alias at excepturi ad quisquam, quod corporis repudiandae assumenda iste modi ut? Voluptas, ducimus!
                </p>
                <div class="video-esquina">                    
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/Xs-abkgp1Bo?si=Aa8NHcrsZDw-g-Cu" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                </div>
                <p>
                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aperiam veritatis provident hic minus alias ullam sapiente dolorum mollitia, saepe perferendis commodi exercitationem tenetur eum voluptates voluptas odio! Iusto, ipsum fugiat. Lorem, ipsum dolor sit amet consectetur adipisicing elit. Autem ratione dignissimos repudiandae assumenda ullam suscipit repellat laborum numquam. Sint aliquam dignissimos, explicabo et excepturi aliquid ipsam corrupti pariatur ea veniam. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Cupiditate minus perferendis tempora voluptate placeat hic sunt dolor dolores quo molestias consectetur, eaque inventore recusandae at illum necessitatibus nulla earum velit. Lorem ipsum dolor sit amet consectetur adipisicing elit. Nam ipsam saepe corporis dignissimos debitis, quaerat perspiciatis alias veritatis quasi, quis nihil aliquam unde ea deleniti explicabo sit maiores odit iure? Lorem ipsum dolor sit amet consectetur adipisicing elit. Quam, enim neque! Assumenda quam voluptas numquam hic? Alias at excepturi ad quisquam, quod corporis repudiandae assumenda iste modi ut? Voluptas, ducimus!
                </p>
                <h2>
                    Conclusão
                </h2>
                <p>
                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aperiam veritatis provident hic minus alias ullam sapiente dolorum mollitia, saepe perferendis commodi exercitationem tenetur eum voluptates voluptas odio! Iusto, ipsum fugiat. Lorem, ipsum dolor sit amet consectetur adipisicing elit. Autem ratione dignissimos repudiandae assumenda ullam suscipit repellat laborum numquam. Sint aliquam dignissimos, explicabo et excepturi aliquid ipsam corrupti pariatur ea veniam. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Cupiditate minus perferendis tempora voluptate placeat hic sunt dolor dolores quo molestias consectetur, eaque inventore recusandae at illum necessitatibus nulla earum velit. Lorem ipsum dolor sit amet consectetur adipisicing elit. Nam ipsam saepe corporis dignissimos debitis, quaerat perspiciatis alias veritatis quasi, quis nihil aliquam unde ea deleniti explicabo sit maiores odit iure? Lorem ipsum dolor sit amet consectetur adipisicing elit. Quam, enim neque! Assumenda quam voluptas numquam hic? Alias at excepturi ad quisquam, quod corporis repudiandae assumenda iste modi ut? Voluptas, ducimus!
                </p>
                <div class="dono-comentario">
                    <img src="assets/_MG_7034.jpeg" class="img-dono"></img>
                    <p>
                        João Roberto Schettini Santos
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="botao-like-comentario">
        <div class="container-botao-like-comentario">
            <div class="conteudo-like">
                <p>
                    Gostou dessa publicação?
                </p>
                <a onclick="curtir()" id="botao_curtida" class="botao-curtida">
                    <img src="assets/thumbs-up.png" id="img-like" class="img-like"></img>
                </a>
                <p>
                    Curta essa matéria!
                </p>
            </div>
        </div>
    </div>

    <div class="comentario-materia-esquina">
        <div class="container-comentario-esquina">
            <div class="texto-comentario-esquina">
                <div class="titulo-comentario">
                    <h1>
                        Comentários
                    </h1>
                    <p>
                        Diga suas próprias impressões sobre essa matéria!
                    </p>
                </div>
                <div class="area-comentario">
                    <textarea rows="4" type="text" id="text_comentario"></textarea>
                    <button onclick="publicar()">Publicar</button>
                </div>
                <div id="conteudo_comentario" class="conteudo-comentario"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-1">
            <a class="logo-footer" href="conteudo.html">logo</a>
            <nav class="navbar-footer">
                <ul>
                    <li><a href="conteudo.html#musica-semana">Música da Semana</a></li>
                    <li><a href="conteudo.html#conteudo-materias">Matérias</a></li>
                </ul>
            </nav>
        <div class="icons-footer">
            <a href="/">
                <svg id="icon-instagram" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160ZM176,24H80A56.06,56.06,0,0,0,24,80v96a56.06,56.06,0,0,0,56,56h96a56.06,56.06,0,0,0,56-56V80A56.06,56.06,0,0,0,176,24Zm40,152a40,40,0,0,1-40,40H80a40,40,0,0,1-40-40V80A40,40,0,0,1,80,40h96a40,40,0,0,1,40,40ZM192,76a12,12,0,1,1-12-12A12,12,0,0,1,192,76Z"></path></svg>
            </a>
            <a href="/">
                <svg id="icon-spotify" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm31.07-46.26a8,8,0,0,1-10.81,3.33,42.79,42.79,0,0,0-40.52,0,8,8,0,0,1-7.48-14.14,59.33,59.33,0,0,1,55.48,0A8,8,0,0,1,159.07,169.74Zm32-56a8,8,0,0,1-10.83,3.29,110.62,110.62,0,0,0-104.46,0,8,8,0,0,1-7.54-14.12,126.67,126.67,0,0,1,119.54,0A8,8,0,0,1,191.06,113.76Zm-16,28a8,8,0,0,1-10.82,3.3,77,77,0,0,0-72.48,0,8,8,0,0,1-7.52-14.12,93,93,0,0,1,87.52,0A8,8,0,0,1,175.06,141.76Z"></path></svg>
            </a>
        </div>
        </div>
        <div class="footer-2">
            <h5>
                © 2024 Nervo. Todos os direitos reservados.
            </h5>
        </div>
    </footer>

</body>
</html>

<script>
    
    var curtida = 0
    function curtir() {
        var fkMateria = 2
        var idUsuario = sessionStorage.ID_USUARIO;

        if (curtida == 0) {
            curtida+=1
            document.getElementById("img-like").src="assets/thumbs-up-fill.png";

                fetch("/curtida/curtir", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    fkMateriaServer: fkMateria,
                    idUsuarioServer: idUsuario
                })
                })
        } else if (curtida == 1) {
            curtida-=1
            document.getElementById("img-like").src="assets/thumbs-up.png";

            fetch(`/curtida/deletar${idUsuario}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
            }).then(function (resposta) {

            if (resposta.ok) {
                window.alert("Curtida deletada com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        }

    }

    function publicar() {
        var comentario = text_comentario.value
        var fkMateria = 2
        var idUsuario = sessionStorage.ID_USUARIO;
        var nome = sessionStorage.NOME_USUARIO;

        if (comentario == "") {
            alert("Comente algo antes de publicar!")
        } else {
            conteudo_comentario.innerHTML += `<div class="sessao-comentario">
                                            <p class="texto-comentario">
                                               ${comentario}
                                            </p>
                                            <div class="usuario-comentario">
                                            <p>
                                                - ${nome}
                                            </p>
                                        </div>
                                    </div>
                                    `
        }

        fetch("/comentario/publicar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                comentarioServer: comentario,
                fkMateriaServer: fkMateria,
                idUsuarioServer: idUsuario
            })
        })

    }

    function listar() {
        var fkMateria = 2

        fetch(`/comentario/listar${fkMateria}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("conteudo_comentario");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var conteudo = document.getElementById("conteudo_comentario");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        conteudo_comentario.innerHTML += `<div class="sessao-comentario">
                                            <p class="texto-comentario">
                                               ${publicacao.conteudo}
                                            </p>
                                            <div class="usuario-comentario">
                                            <p>
                                                - ${publicacao.nome}
                                            </p>
                                        </div>
                                    </div>
                                    `

                    }


                    finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }

</script>