<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Perfil</title>
    <script src="./js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="AtualizarNivel(),listarArtista(),listarGenero(),graficoComentarios(),graficoCurtidas()">

    <header class="header">
        <a class="logo-header" href="conteudo.html">logo</a>
        <nav class="navbar-header">
            <ul>
                <li><a href="conteudo.html#musica-semana">Música da Semana</a></li>
                <li><a href="conteudo.html#conteudo-materias">Matérias</a></li>
            </ul>
        </nav>
        <ul class="botao">
            <li><a href="perfil.html"><button>Perfil</button></a></li>
        </ul>
    </header>

    <div class="conteudo-perfil">
        <div class="container-conteudo-perfil">
            <div class="conteudo-perfil-titulo">
                <div class="nome-usuario-perfil">
                    <h3>Bem vindo(a), <span id="nome_usuario"></span>!</h3>
                </div>
                <div class="perfil-sair">
                    <a onclick="limparSessao()" href="index.html"><img src="assets/sign-out.png" alt=""></a>
                </div>
            </div>
            <div class="conteudo-perfil-kpi">
                <div id="kpi_nivel_vinil" class="kpi-nivel-vinil">
                </div>
                <div class="kpi-artista-fav">
                    <div class="titulo-artista">
                        <p>Artista Favorito</p>
                        <a id="editar_artista" href="artista.html"><img src="assets/pencil-simple-light.png" alt=""></a>
                    </div>
                    <div id="artista_fav">

                    </div>
                </div>
                <div class="kpi-genero-fav">
                    <div class="titulo-genero">
                        <p>Genêros Favoritos</p>
                        <a id="editar_genero" href="genero.html"><img src="assets/pencil-simple-light.png" alt=""></a>
                    </div>
                    <div id="genero_fav" class="genero-fav">

                    </div>
                </div>
            </div>
            <div class="conteudo-perfil-grafico">
                <div class="grafico-comentario">
                    <canvas id="grafico_comentario"></canvas>
                </div>
                <div class="grafico-curtida">
                    <canvas id="grafico_curtida"></canvas>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-1">
            <a class="logo-footer" href="conteudo.html">logo</a>
            <nav class="navbar-footer">
                <ul>
                    <li><a href="conteudo.html#musica-semana">Música da Semana</a></li>
                    <li><a href="conteudo.html#conteudo-materias">Matérias</a></li>
                </ul>
            </nav>
            <div class="icons-footer">
                <a href="/">
                    <svg id="icon-instagram" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000"
                        viewBox="0 0 256 256">
                        <path
                            d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160ZM176,24H80A56.06,56.06,0,0,0,24,80v96a56.06,56.06,0,0,0,56,56h96a56.06,56.06,0,0,0,56-56V80A56.06,56.06,0,0,0,176,24Zm40,152a40,40,0,0,1-40,40H80a40,40,0,0,1-40-40V80A40,40,0,0,1,80,40h96a40,40,0,0,1,40,40ZM192,76a12,12,0,1,1-12-12A12,12,0,0,1,192,76Z">
                        </path>
                    </svg>
                </a>
                <a href="/">
                    <svg id="icon-spotify" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000"
                        viewBox="0 0 256 256">
                        <path
                            d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm31.07-46.26a8,8,0,0,1-10.81,3.33,42.79,42.79,0,0,0-40.52,0,8,8,0,0,1-7.48-14.14,59.33,59.33,0,0,1,55.48,0A8,8,0,0,1,159.07,169.74Zm32-56a8,8,0,0,1-10.83,3.29,110.62,110.62,0,0,0-104.46,0,8,8,0,0,1-7.54-14.12,126.67,126.67,0,0,1,119.54,0A8,8,0,0,1,191.06,113.76Zm-16,28a8,8,0,0,1-10.82,3.3,77,77,0,0,0-72.48,0,8,8,0,0,1-7.52-14.12,93,93,0,0,1,87.52,0A8,8,0,0,1,175.06,141.76Z">
                        </path>
                    </svg>
                </a>
            </div>
        </div>
        <div class="footer-2">
            <h5>
                © 2024 Nervo. Todos os direitos reservados.
            </h5>
        </div>
    </footer>

</body>

</html>

<script>

    nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var idUsuario = sessionStorage.ID_USUARIO

    function AtualizarNivel() {

        fetch(`/perfil/atualizarNivel${idUsuario}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                            if (publicacao.qtdComentarios < 2) {
                                kpi_nivel_vinil.innerHTML = `<div class="img-vinil">
                                                            <img src="assets/vinyl-record-duotone.png" alt="">
                                                            </div>
                                                            <div class="nivel-vinil">
                                                                <p>Nível Viníl</p>
                                                            </div>`
                            } else if (publicacao.qtdComentarios < 4) {
                                kpi_nivel_vinil.innerHTML = `<div class="img-vinil">
                                                            <img src="assets/vinyl-record-fill-ouro.png" alt="">
                                                            </div>
                                                            <div class="nivel-vinil">
                                                                <p>Nível Ouro</p>
                                                            </div>`
                            } else if (publicacao.qtdComentarios < 6) {
                                kpi_nivel_vinil.innerHTML = `<div class="img-vinil">
                                                            <img src="assets/vinyl-record-fill-diamante.png" alt="">
                                                            </div>
                                                            <div class="nivel-vinil">
                                                                <p>Nível Platina</p>
                                                            </div>`
                            } else if (publicacao.qtdComentarios < 9) {
                                kpi_nivel_vinil.innerHTML = `<div class="img-vinil">
                                                            <img src="assets/vinyl-record-fill-platina.png" alt="">
                                                            </div>
                                                            <div class="nivel-vinil">
                                                                <p>Nível Diamante</p>
                                                            </div>`
                            }
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });

    }

    function listarArtista() {

        fetch(`/perfil/listarArtista${idUsuario}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                        artista_fav.innerHTML += `<p>${publicacao.artistaFav}</p>`
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });

    }

    function listarGenero() {

        fetch(`/perfil/listarGenero${idUsuario}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        genero_fav.innerHTML += `<div id="genero-fav-1">
                                                <p>${publicacao.generoFav1}</p>
                                                </div>
                                                <div id="genero-fav-3">
                                                    <p>${publicacao.generoFav2}</p>
                                                </div>
                                                <div id="genero-fav-2">
                                                    <p>${publicacao.generoFav3}</p>
                                                </div>
                                                `
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }

    function graficoComentarios() {

        fetch(`/perfil/graficoComentarios${idUsuario}`)
            .then(response => response.json())
            .then(data => {
                const labels = data.map(item => item.dataPublicacao);
                const qtd = data.map(item => item.qtdComentarios);

                const initialColor = 'rgb(221, 185, 103)';

                const ctx = document.getElementById('grafico_comentario').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Quantidade de Comentários',
                            data: qtd,
                            backgroundColor: initialColor,
                            borderColor: initialColor,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.log("Erro ao carregar os comentários:", error);
            });

    }

    function graficoCurtidas() {

        fetch(`/perfil/graficoCurtidas${idUsuario}`)
            .then(response => response.json())
            .then(data => {
                const labels = data.map(item => item.dataCurtida);
                const qtd = data.map(item => item.qtdCurtidas);

                const initialColor = 'rgb(221, 185, 103)';

                const ctx = document.getElementById('grafico_curtida').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Quantidade de Curtidas',
                            data: qtd,
                            backgroundColor: initialColor,
                            borderColor: initialColor,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.log("Erro ao carregar as curtidas:", error);
            });

    }

</script>